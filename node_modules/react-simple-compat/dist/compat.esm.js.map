{"version":3,"file":"compat.esm.js","sources":["../src/Compat.tsx"],"sourcesContent":["import { diff } from \"@egjs/list-differ\";\nimport { IObject, isUndefined, isString, isArray, decamelize, isNumber } from \"@daybrush/utils\";\nimport { CompatElement } from \"./types\";\n\nfunction isDiff(a: object, b: object) {\n    if (a === b) { return false; }\n    for (const i in a) {\n        if (!(i in b)) {\n            return true;\n        }\n    }\n    for (const i in b) {\n        if (a[i] !== b[i]) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction diffObject(a: object, b: object) {\n    const keys1 = Object.keys(a);\n    const keys2 = Object.keys(b);\n\n    const result = diff(keys1, keys2, key => key);\n\n    const added: IObject<any> = {};\n    const removed: IObject<any> = {};\n    const changed: IObject<any> = {};\n\n    result.added.forEach(index => {\n        const name = keys2[index];\n\n        added[name] = b[name];\n    });\n    result.removed.forEach(index => {\n        const name = keys1[index];\n\n        removed[name] = a[name];\n    });\n    result.maintained.forEach(([index]) => {\n        const name = keys1[index];\n        const values = [a[name], b[name]];\n\n        if (a[name] !== b[name]) {\n            changed[name] = values;\n        }\n    });\n    return {\n        added,\n        removed,\n        changed,\n    };\n}\nfunction executeHooks(hooks: Function[]) {\n    hooks.forEach(hook => {\n        hook();\n    });\n}\nfunction fillKeys(keys: any[]): string[] {\n    let index = 0;\n\n    return keys.map(key => key == null ? `$compat${++index}` : `${key}`);\n}\nfunction createProvider(el: CompatElement | string, key: string, index: number, container?: Provider) {\n    if (isString(el) || isNumber(el)) {\n        return new TextProvider(`text_${el}`, key, index, container, null, {});\n    }\n    const providerClass\n        = typeof el.type === \"string\"\n            ? ElementProvider\n            : el.type.prototype.render\n                ? ComponentProvider\n                : FunctionProvider;\n\n    return new providerClass(\n        el.type,\n        key,\n        index,\n        container,\n        el.ref,\n        el.props,\n    );\n}\nfunction flat(arr: any[]) {\n    let arr2 = [];\n\n    arr.forEach(el => {\n        arr2 = arr2.concat(isArray(el) ? flat(el) : el);\n    });\n\n    return arr2;\n}\nfunction getAttributes(props: IObject<any>) {\n    const { className, ...otherProps } = props;\n\n    if (className != null) {\n        otherProps.class = className;\n    }\n    delete otherProps.style;\n    delete otherProps.children;\n    return otherProps;\n}\nfunction fillProps(props: IObject<any>, defaultProps: IObject<any>) {\n    if (!defaultProps) {\n        return props;\n    }\n    for (const name in defaultProps) {\n        if (isUndefined(props[name])) {\n            props[name] = defaultProps[name];\n        }\n    }\n    return props;\n}\nexport function createElement(\n    type: any,\n    props: any,\n    ...children: any[]\n): CompatElement {\n    const { key, ref, ...otherProps } = props || {};\n\n    return {\n        type,\n        key,\n        ref,\n        props: { ...otherProps, children: flat(children).filter(child => child != null && child !== false) },\n    };\n}\nabstract class Provider<T extends Element | Component | Node = Element | Component | Node> {\n    public original: CompatElement | string;\n    public base: T;\n    public _providers: Array<Provider<any>> = [];\n    constructor(\n        public type: any,\n        public key: string,\n        public index: number,\n        public container?: Provider | null,\n        public ref?: (e: Element | Component | Node) => any,\n        public props: IObject<any> = {},\n    ) { }\n    public abstract _render(hooks: Function[], prevProps: any, nextState: any);\n    public abstract _unmount();\n    public _should(nextProps: any, nextState: any): boolean {\n        return true;\n    }\n    public _update(\n        hooks: Function[],\n        nextElement: CompatElement | string,\n        nextState?: any,\n        isForceUpdate?: boolean,\n    ) {\n        if (\n            this.base\n            && !isString(nextElement)\n            && !isForceUpdate\n            && !this._should(nextElement.props, nextState)\n        ) {\n            return false;\n        }\n        this.original = nextElement;\n        this._setState(nextState);\n        // render\n        const prevProps = this.props;\n\n        if (!isString(nextElement)) {\n            this.props = nextElement.props;\n            this.ref = nextElement.ref;\n        }\n        this._render(hooks, this.base ? prevProps : {}, nextState);\n        return true;\n    }\n    public _mounted() {\n        const ref = this.ref;\n        ref && ref(this.base);\n    }\n    public _setState(nextstate: IObject<any>) {\n        return;\n    }\n    public _updated() {\n        const ref = this.ref;\n        ref && ref(this.base);\n    }\n    public _destroy() {\n        const ref = this.ref;\n        ref && ref(null);\n    }\n}\nfunction diffAttributes(attrs1: IObject<any>, attrs2: IObject<any>, el: Element) {\n    const { added, removed, changed } = diffObject(attrs1, attrs2);\n    for (const name in added) {\n        el.setAttribute(name, added[name]);\n    }\n    for (const name in changed) {\n        el.setAttribute(name, changed[name][1]);\n    }\n    for (const name in removed) {\n        el.removeAttribute(name);\n    }\n}\nfunction diffEvents(\n    events1: IObject<any>,\n    events2: IObject<any>,\n    provier: ElementProvider,\n) {\n    const { added, removed, changed } = diffObject(events1, events2);\n\n    for (const name in removed) {\n        provier.removeEventListener(name);\n    }\n    for (const name in added) {\n        provier.addEventListener(name, added[name]);\n    }\n    for (const name in changed) {\n        provier.removeEventListener(name);\n        provier.addEventListener(name, changed[name][1]);\n    }\n    for (const name in removed) {\n        provier.removeEventListener(name);\n    }\n}\nfunction diffStyle(style1: IObject<any>, style2: IObject<any>, el: HTMLElement | SVGElement) {\n    const style = el.style;\n    const { added, removed, changed } = diffObject(style1, style2);\n\n    for (const beforeName in added) {\n        const name = decamelize(beforeName, \"-\");\n\n        if (style.setProperty) {\n            style.setProperty(name, added[beforeName]);\n        } else {\n            style[name] = added[beforeName];\n        }\n    }\n    for (const beforeName in changed) {\n        const name = decamelize(beforeName, \"-\");\n\n        if (style.setProperty) {\n            style.setProperty(name, changed[beforeName][1]);\n        } else {\n            style[name] = changed[beforeName][1];\n        }\n    }\n    for (const beforeName in removed) {\n        const name = decamelize(beforeName, \"-\");\n\n        if (style.removeProperty) {\n            style.removeProperty(name);\n        } else {\n            style[name] = \"\";\n        }\n    }\n}\nfunction splitProps(props: IObject<any>) {\n    const attributes = {};\n    const events = {};\n\n    for (const name in props) {\n        if (name.indexOf(\"on\") === 0) {\n            events[name.replace(\"on\", \"\").toLowerCase()] = props[name];\n        } else {\n            attributes[name] = props[name];\n        }\n    }\n    return {\n        attributes,\n        events,\n    };\n}\nclass TextProvider extends Provider<Node> {\n    public _render(hooks: Function[]) {\n        const isMount = !this.base;\n\n        if (isMount) {\n            this.base = document.createTextNode(this.type.replace(\"text_\", \"\"));\n        }\n        hooks.push(() => {\n            if (isMount) {\n                this._mounted();\n            } else {\n                this._updated();\n            }\n        });\n        return true;\n    }\n    public _unmount() {\n        this.base.parentNode.removeChild(this.base);\n    }\n}\nclass ElementProvider extends Provider<Element> {\n    public events: IObject<Function> = {};\n    public _isSVG = false;\n\n    public addEventListener(name, callback) {\n        const events = this.events;\n\n        events[name] = e => {\n            e.nativeEvent = e;\n            callback(e);\n        };\n        this.base.addEventListener(name, events[name] as any);\n    }\n    public removeEventListener(name) {\n        const events = this.events;\n\n        this.base.removeEventListener(name, events[name] as any);\n\n        delete events[name];\n    }\n    public _should(nextProps: any) {\n        return isDiff(this.props, nextProps);\n    }\n    public _render(hooks: Function[], prevProps: any) {\n        const isMount = !this.base;\n\n        if (isMount) {\n            const isSVG = this._hasSVG();\n\n            this._isSVG = isSVG;\n\n            let element = this.props.portalContainer;\n\n            if (!element) {\n                const type = this.type;\n                if (isSVG) {\n                    element = document.createElementNS(\"http://www.w3.org/2000/svg\", type);\n                } else {\n                    element = document.createElement(type);\n                }\n            }\n            this.base = element;\n        }\n        renderProviders(this, this._providers, this.props.children, hooks, null);\n        const base = this.base;\n\n        const {\n            attributes: prevAttributes,\n            events: prevEvents,\n        } = splitProps(prevProps);\n        const {\n            attributes: nextAttributes,\n            events: nextEvents,\n        } = splitProps(this.props);\n        diffAttributes(\n            getAttributes(prevAttributes),\n            getAttributes(nextAttributes),\n            base,\n        );\n        diffEvents(\n            prevEvents,\n            nextEvents,\n            this,\n        );\n        diffStyle(\n            prevProps.style || {},\n            this.props.style || {},\n            base as HTMLElement,\n        );\n        hooks.push(() => {\n            if (isMount) {\n                this._mounted();\n            } else {\n                this._updated();\n            }\n        });\n        return true;\n    }\n    public _unmount() {\n        const events = this.events;\n        const base = this.base;\n\n        for (const name in events) {\n            base.removeEventListener(name, events[name] as any);\n        }\n        this._providers.forEach(provider => {\n            provider._unmount();\n        });\n        this.events = {};\n\n        if (!this.props.portalContainer) {\n            base.parentNode.removeChild(base);\n        }\n    }\n    private _hasSVG() {\n        if (this._isSVG || this.type === \"svg\") {\n            return true;\n        }\n        const containerNode = findContainerNode(this.container);\n\n        return containerNode && \"ownerSVGElement\" in containerNode;\n    }\n}\nfunction findContainerNode(provider: Provider): Node | null {\n    if (!provider) {\n        return null;\n    }\n    const base = provider.base;\n    if (base instanceof Node) {\n        return base;\n    }\n    return findContainerNode(provider.container);\n}\nexport function findDOMNode(comp: Component | Node | null): Node | null {\n    if (!comp) {\n        return null;\n    }\n    if (comp instanceof Node) {\n        return comp;\n    }\n    const providers = comp.$_provider._providers;\n    if (!providers.length) {\n        return null;\n    }\n    return findDOMNode(providers[0].base);\n}\nclass FunctionProvider extends Provider<Component> {\n    public _render(hooks: Function[]) {\n        const template = this.type(this.props);\n\n        renderProviders(this, this._providers, template ? [template] : [], hooks);\n        return true;\n    }\n    public _unmount() {\n        this._providers.forEach(provider => {\n            provider._unmount();\n        });\n    }\n}\nclass ContainerProvider extends Provider<any> {\n    constructor(base: Element) {\n        super(\"container\", \"container\", 0, null);\n        this.base = base;\n    }\n    public _render() {\n        return true;\n    }\n    public _unmount() {\n        return;\n    }\n}\nclass ComponentProvider extends Provider<Component> {\n    constructor(\n        type: typeof Component,\n        key: string,\n        index: number,\n        container: Provider | null,\n        ref: (e: Element | Component | Node) => any,\n        props: IObject<any> = {},\n    ) {\n        super(type, key, index, container, ref, fillProps(props, type.defaultProps));\n    }\n    public _should(nextProps: any, nextState: any) {\n        return this.base.shouldComponentUpdate(\n            fillProps(nextProps, this.type.defaultProps),\n            nextState || this.base.state,\n        );\n    }\n    public _render(hooks: Function[], prevProps, nextState) {\n        this.props = fillProps(this.props, this.type.defaultProps);\n        const isMount = !this.base;\n\n        if (isMount) {\n            this.base = new this.type(this.props);\n            this.base.$_provider = this;\n        } else {\n            this.base.props = this.props;\n        }\n        const base = this.base;\n        const prevState = base.state;\n        const template = base.render();\n\n        if (template && template.props && !template.props.children.length) {\n            template.props.children = this.props.children;\n        }\n        renderProviders(\n            this,\n            this._providers,\n            template ? [template] : [],\n            hooks,\n            nextState,\n            null,\n        );\n        hooks.push(() => {\n            if (isMount) {\n                this._mounted();\n                base.componentDidMount();\n            } else {\n                this._updated();\n                base.componentDidUpdate(prevProps, prevState);\n            }\n        });\n    }\n    public _setState(nextState?: IObject<any>) {\n        const base = this.base;\n\n        if (!base || !nextState) {\n            return;\n        }\n        base.state = nextState;\n    }\n    public _unmount() {\n        this._providers.forEach(provider => {\n            provider._unmount();\n        });\n        clearTimeout(this.base.$_timer);\n        this.base.componentWillUnmount();\n    }\n}\nexport class Component {\n    public static defaultProps?: IObject<any>;\n    public state: IObject<any> = {};\n    public $_provider: ComponentProvider;\n    public $_timer = 0;\n    public $_state: IObject<any> = {};\n\n    constructor(public props: IObject<any> = {}) { }\n    public shouldComponentUpdate(props?: any, state?: any): boolean {\n        return true;\n    }\n    public render() {\n        return null;\n    }\n    public setState(state: IObject<any>, callback?: Function, isForceUpdate?: boolean) {\n        if (!this.$_timer) {\n            this.$_state = {};\n        }\n        clearTimeout(this.$_timer);\n\n        this.$_timer = 0;\n        this.$_state = {...this.$_state, ...state};\n\n        if (!isForceUpdate) {\n            this.$_timer = setTimeout(() => {\n                this.$_timer = 0;\n                this.$_setState(callback, isForceUpdate);\n            });\n        } else {\n            this.$_setState(callback, isForceUpdate);\n        }\n        return;\n    }\n    public forceUpdate(callback?: Function) {\n        this.setState({}, callback, true);\n    }\n    public componentDidMount() { }\n    public componentDidUpdate(prevProps, prevState) { }\n    public componentWillUnmount() { }\n    private $_setState(callback?: Function, isForceUpdate?: boolean) {\n        const hooks: Function[] = [];\n        const provider = this.$_provider;\n        const isUpdate = renderProviders(\n            provider.container,\n            [provider],\n            [provider.original],\n            hooks,\n            { ...this.state, ...this.$_state },\n            isForceUpdate,\n        );\n        if (isUpdate) {\n            if (callback) {\n                hooks.push(callback);\n            }\n            executeHooks(hooks);\n        }\n    }\n}\nexport class PureComponent extends Component {\n    public shouldComponentUpdate(props?, state?) {\n        return isDiff(this.props, props) || isDiff(this.state, state);\n    }\n}\nclass _Portal extends PureComponent {\n    public _portalProvider: Provider;\n    public componentDidMount() {\n        const { element, container } = this.props;\n\n        this._portalProvider = new ContainerProvider(container);\n\n        renderProvider(element, container, this._portalProvider);\n    }\n    public componentDidUpdate() {\n        const { element, container } = this.props;\n\n        renderProvider(element, container, this._portalProvider);\n    }\n    public componentWillUnmount() {\n        const { container } = this.props;\n\n        renderProvider(null, container, this._portalProvider);\n        this._portalProvider = null;\n    }\n}\nfunction updateProvider(\n    provider: Provider,\n    children: Array<CompatElement | string>,\n    nextState?: any,\n) {\n    const hooks: Function[] = [];\n    renderProviders(\n        provider,\n        provider._providers,\n        children,\n        hooks,\n        nextState,\n    );\n    executeHooks(hooks);\n}\nfunction getNextSibiling(\n    provider: Provider,\n    childProvider: Provider,\n) {\n    const childProviders = provider._providers;\n    const length = childProviders.length;\n\n    for (let i = childProvider.index + 1; i < length; ++i) {\n        const el = findDOMNode(childProviders[i].base);\n\n        if (el) {\n            return el;\n        }\n    }\n    return null;\n}\nfunction diffProviders(\n    containerProvider: Provider,\n    providers: Provider[],\n    children: Array<CompatElement | string>,\n) {\n    const childrenKeys = children.map(p => isString(p) ? null : p.key);\n    const keys1 = fillKeys(providers.map(p => p.key));\n    const keys2 = fillKeys(childrenKeys);\n    const result = diff(keys1, keys2, key => key);\n\n    result.removed.forEach(index => {\n        providers.splice(index, 1)[0]._unmount();\n    });\n    result.ordered.forEach(([from, to]) => {\n        const childrenProvider = providers.splice(from, 1)[0];\n\n        providers.splice(to, 0, childrenProvider);\n\n        const el = findDOMNode(childrenProvider.base);\n        const next = findDOMNode(providers[to + 1] && providers[to + 1].base);\n\n        if (el) {\n            el.parentNode.insertBefore(el, next);\n        }\n    });\n    result.added.forEach(index => {\n        providers.splice(index, 0, createProvider(children[index], childrenKeys[index], index, containerProvider));\n    });\n    const changed = result.maintained.filter(([_, to]) => {\n        const el = children[to];\n        const childProvider = providers[to];\n        const type = isString(el) ? `text_${el}` : el.type;\n\n        if (type !== childProvider.type) {\n            childProvider._unmount();\n            providers.splice(to, 1, createProvider(el, childrenKeys[to], to, containerProvider));\n            return true;\n        }\n        childProvider.index = to;\n        return false;\n    });\n\n    return [\n        ...result.added,\n        ...changed.map(([_, to]) => to),\n    ];\n}\nfunction renderProviders(\n    containerProvider: Provider | null,\n    providers: Provider[],\n    children: Array<CompatElement | string>,\n    updatedHooks: Function[],\n    nextState?: any,\n    isForceUpdate?: boolean,\n) {\n    const result = diffProviders(containerProvider, providers, children);\n    const updated = providers.filter((childProvider, i) => {\n        return childProvider._update(updatedHooks, children[i], nextState, isForceUpdate);\n    });\n    const containerNode = findContainerNode(containerProvider);\n\n    if (containerNode) {\n        result.reverse().forEach(index => {\n            const childProvider = providers[index];\n            const el = findDOMNode(childProvider.base);\n\n            if (!el) {\n                return;\n            }\n            if (containerNode !== el && !el.parentNode) {\n                const nextElement = getNextSibiling(containerProvider, childProvider);\n                containerNode.insertBefore(el, nextElement);\n            }\n        });\n    }\n    return updated.length > 0;\n}\nfunction renderProvider(\n    element: any,\n    container: Element,\n    provider: Provider = (container as any).__REACT_COMPAT__,\n) {\n    const isProvider = !!provider;\n\n    if (!provider) {\n        provider = new ContainerProvider(container);\n    }\n    updateProvider(provider, element ? [element] : []);\n\n    if (!isProvider) {\n        (container as any).__REACT_COMPAT__ = provider;\n    }\n    return provider;\n}\nexport function render(element: any, container: Element, callback?: Function) {\n    const provider = (container as any).__REACT_COMPAT__;\n    if (element && !provider) {\n        container.innerHTML = \"\";\n    }\n    renderProvider(element, container, provider);\n    callback && callback();\n}\n\nexport function createPortal(el: any, container: Element) {\n    return <_Portal element={el} container={container} />;\n}\n\nexport const version = \"simple-1.1.0\"\n"],"names":["isDiff","a","b","i","diffObject","keys1","Object","keys","keys2","result","diff","key","added","removed","changed","forEach","index","name","maintained","_a","values","executeHooks","hooks","hook","fillKeys","map","createProvider","el","container","isString","isNumber","TextProvider","providerClass","type","ElementProvider","prototype","render","ComponentProvider","FunctionProvider","ref","props","flat","arr","arr2","concat","isArray","getAttributes","className","otherProps","class","style","children","fillProps","defaultProps","isUndefined","createElement","_i","filter","child","nextProps","nextState","nextElement","isForceUpdate","base","_should","original","_setState","prevProps","_render","nextstate","diffAttributes","attrs1","attrs2","setAttribute","removeAttribute","diffEvents","events1","events2","provier","removeEventListener","addEventListener","diffStyle","style1","style2","beforeName","decamelize","setProperty","removeProperty","splitProps","attributes","events","indexOf","replace","toLowerCase","__extends","isMount","document","createTextNode","push","_this","_mounted","_updated","parentNode","removeChild","Provider","callback","e","nativeEvent","isSVG","_hasSVG","_isSVG","element","portalContainer","createElementNS","renderProviders","_providers","prevAttributes","prevEvents","_b","nextAttributes","nextEvents","provider","_unmount","containerNode","findContainerNode","Node","findDOMNode","comp","providers","$_provider","length","template","_super","shouldComponentUpdate","state","prevState","componentDidMount","componentDidUpdate","clearTimeout","$_timer","componentWillUnmount","$_state","setTimeout","$_setState","setState","isUpdate","Component","_portalProvider","ContainerProvider","renderProvider","PureComponent","updateProvider","getNextSibiling","childProvider","childProviders","diffProviders","containerProvider","childrenKeys","p","splice","ordered","from","to","childrenProvider","next","insertBefore","_","updatedHooks","updated","_update","reverse","__REACT_COMPAT__","isProvider","innerHTML","createPortal","_Portal","version"],"mappings":"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"}